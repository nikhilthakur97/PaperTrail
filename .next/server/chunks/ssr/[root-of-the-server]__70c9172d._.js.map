{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["file:///Users/nikhil/Downloads/App/app/database/schema.ts"],"sourcesContent":["import { pgTable, text, timestamp, integer, jsonb, boolean, pgEnum, index, primaryKey } from 'drizzle-orm/pg-core';\nimport { relations } from 'drizzle-orm';\nimport type { AdapterAccount } from 'next-auth/adapters';\n\n// ===========================\n// ENUMS\n// ===========================\n\nexport const roleEnum = pgEnum('role', ['user', 'assistant', 'system']);\nexport const sourceTypeEnum = pgEnum('source_type', ['pubmed', 'arxiv', 'upload']);\nexport const jobStatusEnum = pgEnum('job_status', ['pending', 'processing', 'completed', 'failed']);\nexport const jobTypeEnum = pgEnum('job_type', ['ingestion', 'pdf_generation', 'embedding', 'artifact_creation']);\nexport const embeddingStatusEnum = pgEnum('embedding_status', ['pending', 'processing', 'completed', 'failed']);\n\n// ===========================\n// AUTHENTICATION TABLES (NextAuth)\n// ===========================\n\n/**\n * Users table - stores user profiles\n * Supports both email/password and OAuth (Google) login\n */\nexport const users = pgTable('users', {\n  id: text('id').primaryKey().$defaultFn(() => crypto.randomUUID()),\n  name: text('name'),\n  email: text('email').unique(),\n  emailVerified: timestamp('emailVerified', { mode: 'date' }),\n  image: text('image'),\n  // Password hash only for email/password users (null for OAuth-only)\n  passwordHash: text('password_hash'),\n  createdAt: timestamp('created_at', { mode: 'date' }).defaultNow().notNull(),\n  updatedAt: timestamp('updated_at', { mode: 'date' }).defaultNow().notNull(),\n});\n\n/**\n * Accounts table - links users to OAuth providers\n * One user can have multiple accounts (Google + credentials)\n */\nexport const accounts = pgTable('accounts', {\n  userId: text('userId')\n    .notNull()\n    .references(() => users.id, { onDelete: 'cascade' }),\n  type: text('type').$type<AdapterAccount['type']>().notNull(),\n  provider: text('provider').notNull(),\n  providerAccountId: text('providerAccountId').notNull(),\n  refresh_token: text('refresh_token'),\n  access_token: text('access_token'),\n  expires_at: integer('expires_at'),\n  token_type: text('token_type'),\n  scope: text('scope'),\n  id_token: text('id_token'),\n  session_state: text('session_state'),\n}, (account) => ({\n  compoundKey: primaryKey({\n    columns: [account.provider, account.providerAccountId],\n  }),\n}));\n\n/**\n * Sessions table - tracks active user sessions\n * Optional with JWT strategy but useful for session management\n */\nexport const sessions = pgTable('sessions', {\n  sessionToken: text('sessionToken').primaryKey(),\n  userId: text('userId')\n    .notNull()\n    .references(() => users.id, { onDelete: 'cascade' }),\n  expires: timestamp('expires', { mode: 'date' }).notNull(),\n});\n\n/**\n * Verification tokens - for email verification\n */\nexport const verificationTokens = pgTable('verificationToken', {\n  identifier: text('identifier').notNull(),\n  token: text('token').notNull(),\n  expires: timestamp('expires', { mode: 'date' }).notNull(),\n}, (vt) => ({\n  compoundKey: primaryKey({ columns: [vt.identifier, vt.token] }),\n}));\n\n// ===========================\n// APPLICATION TABLES\n// ===========================\n\n/**\n * Threads table - conversation sessions\n * Each thread contains multiple messages\n */\nexport const threads = pgTable('threads', {\n  id: text('id').primaryKey().$defaultFn(() => crypto.randomUUID()),\n  userId: text('user_id')\n    .notNull()\n    .references(() => users.id, { onDelete: 'cascade' }),\n  // Title auto-generated from first message or user-provided\n  title: text('title').notNull(),\n  createdAt: timestamp('created_at', { mode: 'date' }).defaultNow().notNull(),\n  updatedAt: timestamp('updated_at', { mode: 'date' }).defaultNow().notNull(),\n}, (table) => ({\n  userIdIdx: index('threads_user_id_idx').on(table.userId),\n}));\n\n/**\n * Messages table - individual chat messages\n * Stores both user prompts and AI responses\n */\nexport const messages = pgTable('messages', {\n  id: text('id').primaryKey().$defaultFn(() => crypto.randomUUID()),\n  threadId: text('thread_id')\n    .notNull()\n    .references(() => threads.id, { onDelete: 'cascade' }),\n  role: roleEnum('role').notNull(),\n  content: text('content').notNull(),\n  // Metadata: { citations: [...], artifacts: [...], streaming_complete: boolean }\n  metadata: jsonb('metadata'),\n  createdAt: timestamp('created_at', { mode: 'date' }).defaultNow().notNull(),\n}, (table) => ({\n  threadIdIdx: index('messages_thread_id_idx').on(table.threadId),\n}));\n\n/**\n * Documents table - source materials\n * Tracks PubMed articles, arXiv papers, and user uploads\n */\nexport const documents = pgTable('documents', {\n  id: text('id').primaryKey().$defaultFn(() => crypto.randomUUID()),\n  sourceType: sourceTypeEnum('source_type').notNull(),\n  // External IDs: PMID, PMC ID, arXiv ID, or null for uploads\n  externalId: text('external_id'),\n  // Document metadata\n  title: text('title').notNull(),\n  authors: text('authors'), // JSON array or comma-separated\n  year: integer('year'),\n  abstract: text('abstract'),\n  doi: text('doi'),\n  url: text('url'),\n  // File storage\n  filePath: text('file_path'), // Path in MinIO\n  fileType: text('file_type'), // pdf, txt, md\n  // Licensing and permissions\n  license: text('license'), // open-access, restricted, etc.\n  canRedistribute: boolean('can_redistribute').default(false),\n  // Processing status\n  embeddingStatus: embeddingStatusEnum('embedding_status').default('pending'),\n  // If uploaded by user, track which thread\n  uploadedByUserId: text('uploaded_by_user_id').references(() => users.id, { onDelete: 'set null' }),\n  uploadedInThreadId: text('uploaded_in_thread_id').references(() => threads.id, { onDelete: 'set null' }),\n  // Metadata for chunking/embedding\n  metadata: jsonb('metadata'), // { chunk_count, embedding_model, etc. }\n  createdAt: timestamp('created_at', { mode: 'date' }).defaultNow().notNull(),\n  updatedAt: timestamp('updated_at', { mode: 'date' }).defaultNow().notNull(),\n}, (table) => ({\n  externalIdIdx: index('documents_external_id_idx').on(table.externalId),\n  sourceTypeIdx: index('documents_source_type_idx').on(table.sourceType),\n  embeddingStatusIdx: index('documents_embedding_status_idx').on(table.embeddingStatus),\n}));\n\n/**\n * Message Citations - junction table linking messages to source documents\n */\nexport const messageCitations = pgTable('message_citations', {\n  id: text('id').primaryKey().$defaultFn(() => crypto.randomUUID()),\n  messageId: text('message_id')\n    .notNull()\n    .references(() => messages.id, { onDelete: 'cascade' }),\n  documentId: text('document_id')\n    .notNull()\n    .references(() => documents.id, { onDelete: 'cascade' }),\n  // Relevance score from retrieval\n  relevanceScore: integer('relevance_score'),\n  // Which chunk was cited\n  chunkIndex: integer('chunk_index'),\n  createdAt: timestamp('created_at', { mode: 'date' }).defaultNow().notNull(),\n}, (table) => ({\n  messageIdIdx: index('message_citations_message_id_idx').on(table.messageId),\n  documentIdIdx: index('message_citations_document_id_idx').on(table.documentId),\n}));\n\n/**\n * Jobs table - background task tracking\n * Used for ingestion, PDF generation, embeddings, etc.\n */\nexport const jobs = pgTable('jobs', {\n  id: text('id').primaryKey().$defaultFn(() => crypto.randomUUID()),\n  type: jobTypeEnum('type').notNull(),\n  status: jobStatusEnum('status').default('pending').notNull(),\n  // Input parameters as JSON\n  payload: jsonb('payload'),\n  // Output/results as JSON (file paths, stats, etc.)\n  result: jsonb('result'),\n  // Error message if failed\n  error: text('error'),\n  // Progress tracking (0-100)\n  progress: integer('progress').default(0),\n  // Optional: link to user who triggered job\n  triggeredByUserId: text('triggered_by_user_id').references(() => users.id, { onDelete: 'set null' }),\n  createdAt: timestamp('created_at', { mode: 'date' }).defaultNow().notNull(),\n  startedAt: timestamp('started_at', { mode: 'date' }),\n  completedAt: timestamp('completed_at', { mode: 'date' }),\n}, (table) => ({\n  statusIdx: index('jobs_status_idx').on(table.status),\n  typeIdx: index('jobs_type_idx').on(table.type),\n}));\n\n// ===========================\n// RELATIONS (for Drizzle queries)\n// ===========================\n\nexport const usersRelations = relations(users, ({ many }) => ({\n  accounts: many(accounts),\n  sessions: many(sessions),\n  threads: many(threads),\n  uploadedDocuments: many(documents),\n}));\n\nexport const accountsRelations = relations(accounts, ({ one }) => ({\n  user: one(users, {\n    fields: [accounts.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const sessionsRelations = relations(sessions, ({ one }) => ({\n  user: one(users, {\n    fields: [sessions.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const threadsRelations = relations(threads, ({ one, many }) => ({\n  user: one(users, {\n    fields: [threads.userId],\n    references: [users.id],\n  }),\n  messages: many(messages),\n}));\n\nexport const messagesRelations = relations(messages, ({ one, many }) => ({\n  thread: one(threads, {\n    fields: [messages.threadId],\n    references: [threads.id],\n  }),\n  citations: many(messageCitations),\n}));\n\nexport const documentsRelations = relations(documents, ({ one, many }) => ({\n  uploadedBy: one(users, {\n    fields: [documents.uploadedByUserId],\n    references: [users.id],\n  }),\n  uploadedInThread: one(threads, {\n    fields: [documents.uploadedInThreadId],\n    references: [threads.id],\n  }),\n  citations: many(messageCitations),\n}));\n\nexport const messageCitationsRelations = relations(messageCitations, ({ one }) => ({\n  message: one(messages, {\n    fields: [messageCitations.messageId],\n    references: [messages.id],\n  }),\n  document: one(documents, {\n    fields: [messageCitations.documentId],\n    references: [documents.id],\n  }),\n}));\n\nexport const jobsRelations = relations(jobs, ({ one }) => ({\n  triggeredBy: one(users, {\n    fields: [jobs.triggeredByUserId],\n    references: [users.id],\n  }),\n}));\n\n// ===========================\n// TYPE EXPORTS (for TypeScript)\n// ===========================\n\nexport type User = typeof users.$inferSelect;\nexport type NewUser = typeof users.$inferInsert;\n\nexport type Thread = typeof threads.$inferSelect;\nexport type NewThread = typeof threads.$inferInsert;\n\nexport type Message = typeof messages.$inferSelect;\nexport type NewMessage = typeof messages.$inferInsert;\n\nexport type Document = typeof documents.$inferSelect;\nexport type NewDocument = typeof documents.$inferInsert;\n\nexport type MessageCitation = typeof messageCitations.$inferSelect;\nexport type NewMessageCitation = typeof messageCitations.$inferInsert;\n\nexport type Job = typeof jobs.$inferSelect;\nexport type NewJob = typeof jobs.$inferInsert;\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 387, "column": 0}, "map": {"version":3,"sources":["file:///Users/nikhil/Downloads/App/app/database/db-server.ts"],"sourcesContent":["import { neon } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-http';\nimport * as schema from './schema';\n\n// Initialize Neon serverless connection\nconst sql = neon(process.env.DATABASE_URL!);\n\n// Create Drizzle instance with schema for relational queries\nexport const db = drizzle({ client: sql, schema });\n\n// Export schema for NextAuth adapter and type inference\nexport { schema };\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,wCAAwC;AACxC,MAAM,MAAM,IAAA,8JAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;AAGlC,MAAM,KAAK,IAAA,mKAAO,EAAC;IAAE,QAAQ;IAAK,QAAA;AAAO","debugId":null}},
    {"offset": {"line": 408, "column": 0}, "map": {"version":3,"sources":["file:///Users/nikhil/Downloads/App/app/lib/auth.ts"],"sourcesContent":["import NextAuth from \"next-auth\";\nimport GoogleProvider from \"next-auth/providers/google\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\nimport { DrizzleAdapter } from \"@auth/drizzle-adapter\";\nimport { db } from \"@/app/database/db-server\";\nimport { users, accounts, sessions, verificationTokens } from \"@/app/database/schema\";\nimport { eq } from \"drizzle-orm\";\nimport bcrypt from \"bcryptjs\";\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n  adapter: DrizzleAdapter(db, {\n    usersTable: users,\n    accountsTable: accounts,\n    sessionsTable: sessions,\n    verificationTokensTable: verificationTokens,\n  }),\n  session: {\n    strategy: \"jwt\", // Using JWT for sessions (faster, stateless)\n  },\n  pages: {\n    signIn: \"/login\", // Custom login page\n  },\n  providers: [\n    // Google OAuth Provider\n    GoogleProvider({\n      clientId: process.env.GOOGLE_CLIENT_ID!,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n      allowDangerousEmailAccountLinking: true, // Allow linking Google to existing email\n    }),\n\n    // Email/Password Credentials Provider\n    CredentialsProvider({\n      name: \"credentials\",\n      credentials: {\n        email: { label: \"Email\", type: \"email\" },\n        password: { label: \"Password\", type: \"password\" },\n      },\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) {\n          throw new Error(\"Missing email or password\");\n        }\n\n        // Find user by email\n        const user = await db\n          .select()\n          .from(users)\n          .where(eq(users.email, credentials.email as string))\n          .limit(1);\n\n        if (!user || user.length === 0) {\n          throw new Error(\"No user found with this email\");\n        }\n\n        const dbUser = user[0];\n\n        // Check if user has a password (not OAuth-only)\n        if (!dbUser.passwordHash) {\n          throw new Error(\"Please sign in with Google\");\n        }\n\n        // Verify password\n        const isPasswordValid = await bcrypt.compare(\n          credentials.password as string,\n          dbUser.passwordHash\n        );\n\n        if (!isPasswordValid) {\n          throw new Error(\"Invalid password\");\n        }\n\n        // Return user object (will be encoded in JWT)\n        return {\n          id: dbUser.id,\n          email: dbUser.email,\n          name: dbUser.name,\n          image: dbUser.image,\n        };\n      },\n    }),\n  ],\n  callbacks: {\n    async jwt({ token, user }) {\n      // Add user ID to token on sign in\n      if (user) {\n        token.id = user.id;\n      }\n      return token;\n    },\n    async session({ session, token }) {\n      // Add user ID to session\n      if (session.user) {\n        session.user.id = token.id as string;\n      }\n      return session;\n    },\n  },\n});\n\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEO,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,IAAA,gKAAQ,EAAC;IAC1D,SAAS,IAAA,uKAAc,EAAC,qJAAE,EAAE;QAC1B,YAAY,kIAAK;QACjB,eAAe,qIAAQ;QACvB,eAAe,qIAAQ;QACvB,yBAAyB,+IAAkB;IAC7C;IACA,SAAS;QACP,UAAU;IACZ;IACA,OAAO;QACL,QAAQ;IACV;IACA,WAAW;QACT,wBAAwB;QACxB,IAAA,gKAAc,EAAC;YACb,UAAU,QAAQ,GAAG,CAAC,gBAAgB;YACtC,cAAc,QAAQ,GAAG,CAAC,oBAAoB;YAC9C,mCAAmC;QACrC;QAEA,sCAAsC;QACtC,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBACjD,MAAM,IAAI,MAAM;gBAClB;gBAEA,qBAAqB;gBACrB,MAAM,OAAO,MAAM,qJAAE,CAClB,MAAM,GACN,IAAI,CAAC,kIAAK,EACV,KAAK,CAAC,IAAA,wKAAE,EAAC,kIAAK,CAAC,KAAK,EAAE,YAAY,KAAK,GACvC,KAAK,CAAC;gBAET,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;oBAC9B,MAAM,IAAI,MAAM;gBAClB;gBAEA,MAAM,SAAS,IAAI,CAAC,EAAE;gBAEtB,gDAAgD;gBAChD,IAAI,CAAC,OAAO,YAAY,EAAE;oBACxB,MAAM,IAAI,MAAM;gBAClB;gBAEA,kBAAkB;gBAClB,MAAM,kBAAkB,MAAM,4IAAM,CAAC,OAAO,CAC1C,YAAY,QAAQ,EACpB,OAAO,YAAY;gBAGrB,IAAI,CAAC,iBAAiB;oBACpB,MAAM,IAAI,MAAM;gBAClB;gBAEA,8CAA8C;gBAC9C,OAAO;oBACL,IAAI,OAAO,EAAE;oBACb,OAAO,OAAO,KAAK;oBACnB,MAAM,OAAO,IAAI;oBACjB,OAAO,OAAO,KAAK;gBACrB;YACF;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,kCAAkC;YAClC,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;YACpB;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,yBAAyB;YACzB,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;YAC5B;YACA,OAAO;QACT;IACF;AACF","debugId":null}},
    {"offset": {"line": 519, "column": 0}, "map": {"version":3,"sources":["file:///Users/nikhil/Downloads/App/app/lib/auth-helper.ts"],"sourcesContent":["import { auth } from \"@/app/lib/auth\";\nimport { redirect } from \"next/navigation\";\n\nexport async function requireAuth() {\n  const session = await auth();\n\n  if (!session?.user) {\n    redirect(\"/login\");\n  }\n\n  // TypeScript doesn't know that redirect() throws, so we need to help it\n  // After the redirect check, we know session.user exists\n  return { ...session, user: session.user! };\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;AAEO,eAAe;IACpB,MAAM,UAAU,MAAM,IAAA,0HAAI;IAE1B,IAAI,CAAC,SAAS,MAAM;QAClB,IAAA,iMAAQ,EAAC;IACX;IAEA,wEAAwE;IACxE,wDAAwD;IACxD,OAAO;QAAE,GAAG,OAAO;QAAE,MAAM,QAAQ,IAAI;IAAE;AAC3C","debugId":null}},
    {"offset": {"line": 544, "column": 0}, "map": {"version":3,"sources":["file:///Users/nikhil/Downloads/App/app/components/chat/chat-interface.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ChatInterface = registerClientReference(\n    function() { throw new Error(\"Attempted to call ChatInterface() from the server but ChatInterface is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/components/chat/chat-interface.tsx <module evaluation>\",\n    \"ChatInterface\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,gBAAgB,IAAA,wQAAuB,EAChD;IAAa,MAAM,IAAI,MAAM;AAA0O,GACvQ,wEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 558, "column": 0}, "map": {"version":3,"sources":["file:///Users/nikhil/Downloads/App/app/components/chat/chat-interface.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ChatInterface = registerClientReference(\n    function() { throw new Error(\"Attempted to call ChatInterface() from the server but ChatInterface is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/components/chat/chat-interface.tsx\",\n    \"ChatInterface\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,gBAAgB,IAAA,wQAAuB,EAChD;IAAa,MAAM,IAAI,MAAM;AAA0O,GACvQ,oDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 572, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 580, "column": 0}, "map": {"version":3,"sources":["file:///Users/nikhil/Downloads/App/app/chat/page.tsx"],"sourcesContent":["import { requireAuth } from \"@/app/lib/auth-helper\";\nimport { ChatInterface } from \"@/app/components/chat/chat-interface\";\n\nexport default async function ChatPage() {\n  const session = await requireAuth();\n\n  return <ChatInterface user={session.user} />;\n}\n\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAEe,eAAe;IAC5B,MAAM,UAAU,MAAM,IAAA,2IAAW;IAEjC,qBAAO,8OAAC,gKAAa;QAAC,MAAM,QAAQ,IAAI;;;;;;AAC1C","debugId":null}}]
}